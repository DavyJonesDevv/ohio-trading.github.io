<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ohio Trading & Exchange Co.</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
</head>
<body>

  <!-- Bunker Ceiling Light (flickering) -->
  <div class="ceiling-light"></div>
  <div class="light-flicker"></div>

  <!-- Main Title with hanging light effect -->
  <header class="bunker-header">
    <div class="sign">
      <h1 class="title flicker-text">OHIO TRADING & EXCHANGE CO.</h1>
      <p class="subtitle">UNDERGROUND VAULT VALUES • NOV 28 2025</p>
    </div>
  </header>

  <!-- Tabs -->
  <div class="tabs">
    <button class="tab active" data-tab="vault">VAULT</button>
    <button class="tab" data-tab="calc">TRADE CALCULATOR</button>
  </div>

  <!-- Search Bar -->
  <div class="search-box">
    <input type="text" id="search" placeholder="SEARCH INVENTORY..." autocomplete="off">
  </div>

  <!-- Vault Content -->
  <main id="vault" class="tab-content active">
    <div id="content" class="bunker-content"></div>
  </main>

  <!-- Trade Calculator -->
  <div id="calc" class="tab-content">
    <div class="calculator-grid">
      <div class="side giving">
        <h2>GIVING</h2>
        <div id="giving-list"></div>
        <input type="text" class="add-skin" placeholder="+ ADD SKIN" data-side="giving">
        <div class="total" id="giving-total">$0</div>
      </div>

      <div class="arrow">⟷</div>

      <div class="side receiving">
        <h2>RECEIVING</h2>
        <div id="receiving-list"></div>
        <input type="text" class="add-skin" placeholder="+ ADD SKIN" data-side="receiving">
        <div class="total" id="receiving-total">$0</div>
      </div>
    </div>

    <div class="verdict" id="verdict">—</div>
  </div>

  <footer class="bunker-footer">
    COMMUNITY DRIVEN • NO WARRANTY • 2025
  </footer>

  <script src="skins.js"></script>
  <script>
    const skins = embeddedSkins || [];
    const content = document.getElementById("content");
    const search = document.getElementById("search");

    // Tab switching
    document.querySelectorAll(".tab").forEach(t => {
      t.addEventListener("click", () => {
        document.querySelectorAll(".tab").forEach(b => b.classList.remove("active"));
        document.querySelectorAll(".tab-content").forEach(c => c.classList.remove("active"));
        t.classList.add("active");
        document.getElementById(t.dataset.tab).classList.add("active");
      });
    });

    // Group skins exactly like your original file
    const order = ["Invisible","Obsidian","Dark Matter","Anti Matter","Crimson Bloods","Void Reapers","Underworld","White Ghost","Solid Gold","Gift Wrapped","Christmas Future","Golden Snow","Frozen Gold","Sub Zero","Rainbow Firework","Solid Gold V2","St Patrick","Holy Fire","Bloody Heart","Fallout","Atomic Pumpkin","Ethereal","Spectral","Balloon"];
    const groups = [];
    const used = new Set();

    order.forEach(prefix => {
      const list = skins.filter(s => {
        if (used.has(s.name)) return false;
        if (s.name.includes(prefix)) { used.add(s.name); return true; }
        return false;
      });
      if (list.length) groups.push({ name: prefix, items: list });
    });
    const leftovers = skins.filter(s => !used.has(s.name));
    if (leftovers.length) groups.push({ name: "Limited / Event", items: leftovers });

    function format(num) {
      if (num === 0) return "Unrated";
      if (num >= 1000000) return "$" + (num/1000000).toFixed(1) + "M";
      if (num >= 1000) return "$" + Math.floor(num/1000) + "K";
      return "$" + num;
    }

    function renderVault() {
      const q = search.value.toLowerCase();
      content.innerHTML = "";
      groups.forEach(g => {
        const filtered = g.items.filter(s => s.name.toLowerCase().includes(q));
        if (!filtered.length) return;

        const section = document.createElement("div");
        section.className = "category";
        section.innerHTML = `
          <h2 class="cat-header">${g.name} <span class="count">[${filtered.length}]</span></h2>
          <div class="grid">
            ${filtered.map(s => `
              <div class="card">
                <div class="name">${s.name}</div>
                <div class="value">${format(s.worth)}</div>
                <div class="demand">DEMAND: <span class="d${s.demand === '?' ? ' unknown' : parseFloat(s.demand) >= 8 ? ' high' : parseFloat(s.demand) >= 6 ? ' med' : ' low'}">
                  ${s.demand === "?" ? "???" : s.demand + "/10"}
                </span></div>
              </div>
            `).join("")}
          </div>
        `;
        content.appendChild(section);
      });
    }

    search.addEventListener("input", renderVault);
    renderVault();

    // ——— TRADE CALCULATOR (NOW 100% WORKING) ———
    const givingList = document.getElementById("giving-list");
    const receivingList = document.getElementById("receiving-list");
    const givingTotal = document.getElementById("giving-total");
    const receivingTotal = document.getElementById("receiving-total");
    const verdict = document.getElementById("verdict");

    function addSkin(text, side) {
      const match = skins.find(s => s.name.toLowerCase() === text.toLowerCase());
      if (!match) return false;

      const container = side === "giving" ? givingList : receivingList;
      const div = document.createElement("div");
      div.className = "trade-item";
      div.innerHTML = `
        <span>${match.name}</span>
        <span class="val">${format(match.worth)}</span>
        <button class="remove">×</button>
      `;
      div.querySelector(".remove").onclick = () => { div.remove(); updateCalc(); };
      container.appendChild(div);
      updateCalc();
      return true;
    }

    document.querySelectorAll(".add-skin").forEach(input => {
      input.addEventListener("keydown", e => {
        if (e.key === "Enter" && input.value.trim()) {
          if (addSkin(input.value.trim(), input.dataset.side)) {
            input.value = "";
          }
        }
      });
    });

    function getTotal(container) {
      return Array.from(container.children).reduce((sum, el) => {
        const val = el.querySelector(".val").textContent;
        if (val.includes("Unrated")) return sum;
        const num = parseFloat(val.replace(/[$,MK]/g, ""));
        if (val.includes("M")) return sum + num * 1000000;
        if (val.includes("K")) return sum + num * 1000;
        return sum + num;
      }, 0);
    }

    function updateCalc() {
      const give = getTotal(givingList);
      const receive = getTotal(receivingList);

      givingTotal.textContent = format(give);
      receivingTotal.textContent = format(receive);

      const diff = receive - give;
      const pct = give === 0 ? 0 : (diff / give) * 100;

      let text = "", color = "";
      if (give === 0 && receive === 0) {
        text = "—";
        color = "#666";
      } else if (Math.abs(pct) <= 10) {
        text = "FAIR TRADE";
        color = "#0f0";
      } else if (pct > 10) {
        text = `GOOD TRADE +${pct.toFixed(0)}%`;
        color = "#0f0";
      } else if (pct > -25) {
        text = "SLIGHT OVERPAY";
        color = "#ff0";
      } else {
        text = "BAD TRADE";
        color = "#f00";
      }

      verdict.textContent = text;
      verdict.style.color = color;
      verdict.style.textShadow = `0 0 20px ${color}`;
    }
  </script>
</body>
</html>
